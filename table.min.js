"use strict";function vTable(e){this.config=e,this.filters={},this.sortASC=!0,this.selectedIndexes=[],this.fIndex=0,this.scrollTop=0,this.lIndex=this.config.numberOfVisibleRows,this.config.node&&this.init()}vTable.prototype.init=function(e,t){if(this.config.node=this.config.node||e,this.selectIndex=NaN,this.config.node){if(Array.isArray(t)){var i=0;this.config.data=t.map(function(e){return{...e,_vTableId:i++}}),this._fullData=this.config.data}else this.config.data=[],this._fullData=[];this._createWrapper(),this._createTable(),this._createHeaderWrapper(),this._createHeader(),this._createHeaderRow(),this._createHeaderRowCell(),this._createHeaderRowFilterCell(),this._initScroll(),this._createBody(),this._createBodyRow(),this._ifnoData(),this._createFooter(),this._bind(),this.config.node.appendChild(this.wrapper),this._loading&&this.loadingStart()}else console.error("vTable: undefined parent DOM element")},vTable.prototype.getRowCount=function(){return this.config.data.length},vTable.prototype.setData=function(e){this.destroy(),this.init(!1,e)},vTable.prototype.addData=function(e){var t=this._fullData.length;e=e.map(function(e){return{...e,_vTableId:t++}}),this._fullData=[...this._fullData,...e],this._filter()},vTable.prototype.destroy=function(){this.config.node&&(this.config.node.innerHTML="")},vTable.prototype.selectAll=function(){this.bodyRowArr.forEach(e=>{e.classList.remove("myVTable_body_row_active"),e.classList.add("myVTable_body_row_active")});const e=this;return this.selectedIndexes=[],this.config.data.forEach(function(t){e.selectedIndexes.push(t._vTableId)}),this.config.data},vTable.prototype.removeSelection=function(){this.bodyRowArr.forEach(e=>{e.classList.remove("myVTable_body_row_active")}),this.selectedIndexes=[]},vTable.prototype.loadingStart=function(){this._loading=!0;const e=document.createElement("div");e.classList.add("myVTable_no_loading"),e.style.height="100%";const t=document.createElement("div");e.appendChild(t);const i=this.config.loading||"Loading...";t.innerHTML=i,this.tbody.appendChild(e)},vTable.prototype.loadingStop=function(){this._loading=!1,this.reRender()},vTable.prototype.setFooterContent=function(e){this.footerContent&&(this.contentForFooter=e,this.footerContent=this.footerContent,this.footerContent.innerHTML=e)},vTable.prototype.reRender=function(){this.scrollWrapper.remove(),this._initScroll(),this._createBody(),this._createBodyRow(),this._createBody(),this._createTable(),this._ifnoData(),this.tbody.appendChild(this.fragment),this.table.appendChild(this.tbody),this.scrollWrapper.appendChild(this.tableWrapper),this.scrollWrapper.scrollTop=this.scrollTop,this.config.footer&&this.footerWrapper?(this.footerWrapper.remove(),this._createFooter(),this.wrapper.appendChild(this.footerWrapper),this.wrapper.insertBefore(this.scrollWrapper,this.footerWrapper)):this.wrapper.appendChild(this.scrollWrapper),this.scrollWrapper.scrollTop=this.scrollTop,this._loading&&this.loadingStart()},vTable.prototype._initScroll=function(){this.fullHeight=this.config.data.length*parseInt(this.config.rowHeight),this.tableHeight=parseInt(this.config.rowHeight)*this.config.numberOfVisibleRows;const e=document.createElement("div");e.style.opacity=0,e.style.position="absolute",e.style.top=0,e.style.left=0,e.style.width="1px",e.style.height=this.fullHeight+"px",this.scrollWrapper=document.createElement("div"),this.scrollWrapper.classList.add("myVTable_body_wrapper"),this.scrollWrapper.style.position="relative",this.scrollWrapper.style.height=this.config.height||this.tableHeight+"px",this.scrollWrapper.appendChild(e),this.scrollWrapper.addEventListener("scroll",this._onscroll.bind(this)),this.scrollWrapper.style.overflowY="auto"},vTable.prototype._onscroll=function(e){this.scrollTop=e.target.scrollTop,window.clearTimeout(this.timer);const t=this;this._loading||(this.timer=setTimeout(function(){const e=parseInt(t.config.rowHeight);if(t.fIndex=parseInt(t.scrollTop/e),t.lIndex=t.fIndex+t.config.numberOfVisibleRows,t.lIndex>t.config.data.length?t.lIndex=t.config.data.length:t.stopScrolling=!1,t.stopScrolling)return;const i=document.createDocumentFragment();t.bodyRowArr=[];for(let e=t.fIndex;e<t.lIndex;e++){const o=t._createRow(e);o&&(i.appendChild(o),t.bodyRowArr.push(o),o)}t.tbody.innerHTML="",t.tbody.appendChild(i),t.lIndex===t.config.data.length&&(t.stopScrolling=!0,t.config.next&&t.config.next(t.config.data[t.config.data.length-1]))},10))},vTable.prototype._bind=function(){this.headerCellArr.forEach(e=>{this.headerRow.appendChild(e)}),this.tbody.appendChild(this.fragment),this.header.appendChild(this.headerRow),this.header.appendChild(this.headerRowFilter),this.table.appendChild(this.tbody),this.scrollWrapper.appendChild(this.tableWrapper),this.headerWrapper.appendChild(this.header),this.wrapper.appendChild(this.headerWrapper),this.config.footer?(this.wrapper.appendChild(this.footerWrapper),this.wrapper.insertBefore(this.scrollWrapper,this.footerWrapper)):this.wrapper.appendChild(this.scrollWrapper)},vTable.prototype._createWrapper=function(){this.wrapper=document.createElement("div"),this.wrapper.classList.add("myVTable_wrapper")},vTable.prototype._createHeaderWrapper=function(){this.headerWrapper=document.createElement("div"),this.headerWrapper.classList.add("myVTable_header_wrapper")},vTable.prototype._createFooter=function(){if(this.config.footer){this.footerWrapper=document.createElement("div"),this.footerWrapper.classList.add("myVTable_footer_wrapper"),this.footerWrapper.style.height=parseInt(this.config.footer.height)?parseInt(this.config.footer.height)+"px":parseInt(this.config.rowHeight)+"px",this.footerContent=document.createElement("div"),this.footerContent.classList.add("myVTable_footer_content");const e=this.contentForFooter||this.config.footer.content;this.footerContent.innerHTML=e||"",this.footerWrapper.appendChild(this.footerContent)}},vTable.prototype._createTable=function(){this.tableWrapper=document.createElement("div"),this.tableWrapper.classList.add("myVTable_table_wrapper"),this.tableWrapper.style.position="sticky",this.tableWrapper.style.top=0,this.table=document.createElement("table"),this.table.classList.add("myVTable_table"),this.tableWrapper.appendChild(this.table)},vTable.prototype._createHeader=function(){this.header=document.createElement("table"),this.header.classList.add("myVTable_header")},vTable.prototype._createHeaderRow=function(){this.headerRow=document.createElement("tr"),this.headerRow.classList.add("myVTable_header_row")},vTable.prototype._createHeaderRowCell=function(){this.headerCellArr=[],Array.isArray(this.config.header)&&this.config.header.forEach(e=>{const t=document.createElement("th");t.classList.add("myVTable_header_row_cell"),e.width&&(t.style.width=e.width);const i=this,o=document.createElement("div");o.classList.add("myVTable_header_row_cell_div"),o.innerText=e.title?e.title:"";const r=document.createElement("div");if(r.classList.add("myVTable_header_row_cell_wrapper"),r.appendChild(o),e.sort){r.style.display="flex",r.style.justifyContent="center",r.style.alignItems="center";document.createElement("div");t.classList.add("myVTable_header_row_cell_sort"),t.addEventListener("click",function(){i.loadingStart(),setTimeout(function(){i._sort(e.key),i.loadingStop(),i.headerCellArr.forEach(e=>{e.classList.remove("myVTable_header_row_cell_sort_asc"),e.classList.remove("myVTable_header_row_cell_sort_desc")}),i.sortASC?t.classList.add("myVTable_header_row_cell_sort_asc"):t.classList.add("myVTable_header_row_cell_sort_desc")},0)})}t.appendChild(r),this.headerCellArr.push(t)})},vTable.prototype._createHeaderRowFilterCell=function(){this.headerRowFilter=document.createElement("tr"),this.headerRowFilter.classList.add("myVTable_header_row_filter"),this.headerCellFilterArr=[],this.headerCellDivFilterArr=[];var e=!1;this.config.header.forEach(t=>{t.filter&&(e=!0)}),e&&this.config.header.forEach(e=>{const t=document.createElement("th");if(t.classList.add("myVTable_header_row_cell_filter"),e.width&&(t.style.width=e.width),e.filter){const i=document.createElement("div");i.classList.add("myVTable_header_row_cell_div_filter");const o=this._createHeaderRowInput(e);i.appendChild(o),t.appendChild(i),this.headerCellDivFilterArr.push(i)}this.headerCellFilterArr.push(t),this.headerRowFilter.appendChild(t)})},vTable.prototype._createHeaderRowInput=function(e){const t=document.createElement("input");t.type="text",t.className="myVTable_header_row_cell_input_filter",t.style.width="80%";const i=this;return t.addEventListener("keyup",function(t){i._filter(t.target.value,e.key)}),t},vTable.prototype._filter=function(e,t){t&&(this.filters[t]=e?e.toString().toUpperCase():null);const i=[];this._fullData.forEach(e=>{var t=!0;for(const i in this.filters)if(this.filters[i]){e[i].toString().toUpperCase().includes(this.filters[i])||(t=!1)}t&&i.push(e)}),this._renderFilteredData(i)},vTable.prototype._sort=function(e){this.sortASC=!this.sortASC,this.sortASC?this.config.data.sort(function(t,i){return t[e]>i[e]?1:t[e]<i[e]?-1:0}):this.config.data.sort(function(t,i){return t[e]<i[e]?1:t[e]>i[e]?-1:0}),this._renderFilteredData(this.config.data)},vTable.prototype._renderFilteredData=function(e){this.config.data=e,this.reRender()},vTable.prototype._ifnoData=function(){if(!this.config.data||!this.config.data.length){const e=document.createElement("div");e.classList.add("myVTable_no_data"),e.style.height=this.config.height||this.tableHeight+"px";const t=document.createElement("div");e.appendChild(t);const i=this.config.noDataText||"There is no data";t.innerHTML=i,this.tbody.innerHTML="",this.tbody.appendChild(e)}},vTable.prototype._createBody=function(){this.tbody=document.createElement("tbody"),this.tbody.classList.add("myVTable_body")},vTable.prototype._createBodyRow=function(){if(this.bodyRowArr=[],this.bodyCellArr=[],this.bodyCellDivArr=[],this.fragment=document.createDocumentFragment(),Array.isArray(this.config.data))for(let e=this.fIndex;e<this.lIndex;e++){const t=this._createRow(e);t&&(this.fragment.appendChild(t),this.bodyRowArr.push(t))}},vTable.prototype._createRow=function(e){if(!this.config.data[e])return;const t=document.createElement("tr");return t.classList.add("myVTable_body_row"),t.style.height=this.config.rowHeight+"px",Array.isArray(this.config.header)&&this.config.header.forEach(i=>{const o=document.createElement("th"),r=document.createElement("div");i.width&&(o.style.width=i.width),o.classList.add("myVTable_body_cell"),r.classList.add("myVTable_body_cell_div");const a=i.template?i.template(this.config.data[e],e):this.config.data[e][i.key];r.innerHTML=a,o.appendChild(r),t.appendChild(o),this.bodyCellArr.push(o),this.bodyCellDivArr.push(r)}),Array.isArray(this.selectedIndexes)&&this.selectedIndexes.includes(this.config.data[e]._vTableId)&&t.classList.add("myVTable_body_row_active"),this._addRowActions(t,e),t},vTable.prototype._addRowActions=function(e,t){const i=this;this.config.onRowClick&&e.addEventListener("click",function(){i.config.multiSelect?i._rowMultiSelect(i.config.onRowClick,e,t):i._rowSelect(i.config.onRowClick,e,t)}),this.config.onRowDblClick&&e.addEventListener("dblclick",function(){i.config.multiSelect?i._rowMultiSelect(i.config.onRowDblClick,e,t):i._rowSelect(i.config.onRowDblClick,e,t)})},vTable.prototype._rowSelect=function(e,t,i){this.selectedIndexes=[],this.selectedIndexes.push(this.config.data[i]._vTableId),this.bodyRowArr.forEach(e=>e.classList.remove("myVTable_body_row_active")),t.classList.add("myVTable_body_row_active"),e(this.config.data[i],i)},vTable.prototype._rowMultiSelect=function(e,t,i){const o=t.classList.toggle("myVTable_body_row_active");o?this.selectedIndexes.push(this.config.data[i]._vTableId):this.selectedIndexes=this.selectedIndexes.filter(e=>e!=this.config.data[i]._vTableId),e(this.config.data[i],i,o)};export default vTable;